# 统一门户系统（蓝图整合版）

一个集成五个独立子系统的Web门户应用，提供统一的访问入口和标签页管理功能。

## 🌟 功能特性

- **统一入口**: 通过单一门户访问所有子系统
- **标签页管理**: 支持多标签页切换，类似浏览器体验
- **统一蓝图**: 所有五个子系统均已整合为Flask蓝图，统一使用9000端口管理
- **健康监控**: 实时监控各子系统运行状态，支持详细的组件健康检查
- **响应式设计**: 支持桌面和移动设备访问
- **一键启动**: 启动门户即可访问所有子系统

## 📋 系统架构

```
统一门户系统 (端口: 9000)
├── 智能写作系统 (/writing, Flask蓝图)
├── 业务查询系统 (/qa_sys, Flask蓝图)
├── 数据处理系统 (/case2pg, Flask蓝图)
├── 文件审查系统 (/censor, Flask蓝图)
└── 会议纪要生成系统 (/meeting_minutes, Flask蓝图)
```

## 🚀 快速开始

### 环境要求

- Python 3.7+
- 所有子系统的依赖已安装

### 安装步骤

1. **克隆或下载项目**
   - 所有子系统已整合为Flask蓝图，无需单独启动各自的端口

2. **安装Python依赖**
   ```bash
   cd integrated_portal
   pip install -r requirements.txt
   ```

3. **启动门户**
   - 启动统一门户即可访问所有四个子系统：
   ```bash
   cd integrated_portal
   python app.py
   ```

4. **访问门户**
   
   打开浏览器访问: http://localhost:9000

## 📁 项目结构

```
integrated_portal/
├── app.py                 # 主应用入口
├── start.bat            # Windows 启动脚本
├── requirements.txt      # Python依赖
├── README.md            # 项目说明
├── config/              # 配置模块
│   ├── __init__.py
│   └── settings.py      # 系统配置
├── services/            # 服务模块
│   ├── __init__.py
│   ├── service_manager.py # 服务管理器
│   └── health_check.py  # 健康检查服务
├── utils/               # 工具模块
│   ├── __init__.py
│   └── logger.py        # 日志工具
├── blueprints/          # 子系统蓝图
│   ├── writing.py       # 智能写作系统蓝图
│   ├── qa_sys.py        # 业务查询系统蓝图
│   ├── case2pg.py       # 数据处理系统蓝图
│   ├── censor.py        # 文件审查系统蓝图
│   └── meeting_minutes.py # 会议纪要生成系统蓝图
├── templates/           # HTML 模板
│   ├── base.html        # 基础模板
│   ├── index.html       # 主页模板
│   ├── qa_sys.html      # 业务查询系统模板
│   ├── meeting_minutes.html # 会议纪要生成系统模板
│   └── error.html       # 错误页面模板
└── static/              # 静态资源
    ├── css/
    │   ├── main.css     # 主样式
    │   └── tabs.css     # 标签页样式
    ├── js/
    │   ├── main.js      # 主脚本
    │   └── tab-manager.js # 标签页管理器
    └── favicon.ico      # 网站图标
```

## ⚙️ 配置说明

### 系统配置 (config/settings.py)

```python
# 门户服务配置
HOST = '0.0.0.0'
PORT = 9000
DEBUG = True

# 子系统配置（所有系统均为蓝图）
SUBSYSTEMS = {
    'writing': {
        'name': '智能写作系统',
        'url': 'http://localhost:9000/writing',
        'path': '/writing',
        # ...
    },
    'qa_sys': {
        'name': '业务查询系统',
        'url': 'http://localhost:9000/qa_sys',
        'path': '/qa_sys',
        # ...
    },
    'case2pg': {
        'name': '数据处理系统',
        'url': 'http://localhost:9000/case2pg',
        'path': '/case2pg',
        # ...
    },
    'censor': {
        'name': '文件审查系统',
        'url': 'http://localhost:9000/censor',
        'path': '/censor',
        # ...
    },
    'meeting_minutes': {
        'name': '会议纪要生成系统',
        'url': 'http://localhost:9000/meeting_minutes',
        'path': '/meeting_minutes',
        # ...
    }
}
```

### 端口与路由配置

| 系统 | 路径 | 说明 |
|------|------|------|
| 统一门户 | / | 主入口 (端口 9000) |
| 智能写作系统 | /writing | Flask 蓝图 |
| 业务查询系统 | /qa_sys | Flask 蓝图 |
| 数据处理系统 | /case2pg | Flask 蓝图 |
| 文件审查系统 | /censor | Flask 蓝图 |
| 会议纪要生成系统 | /meeting_minutes | Flask 蓝图 |

## 🔧 使用说明

### 智能写作系统功能

**智能写作系统** 是统一门户的核心功能之一，基于 Flask 和 Dify API 的多功能公文/文章自动生成与辅助写作平台：

#### 主要功能
- **多种公文类型生成**: 支持工作报告、领导讲话、工作要点、处室总结、表态发言等多种公文类型
- **原文改写和仿写**: 支持上传多种格式文件进行改写和仿写操作
- **直接文档上传**: 支持直接上传现有文档，系统智能分析内容并提供优化建议
- **数据库关键词查询**: 可选数据库关键词查询功能
- **联网主题搜索**: 支持联网主题搜索，获取最新信息
- **多文件格式支持**: 支持txt、docx、pdf等多种文件格式上传和处理
- **一键生成PPT**: 支持将生成的报告一键转为PPT，由Dify工作流生成并以SVG形式可视化展示
- **智能PPT制作**: 基于上传文档内容，自动提取关键信息并生成专业演示文稿

#### 使用流程
1. **访问系统首页**: 填写表单信息
2. **选择工作模式**: 
   - **新建文档**: 选择公文类型、主题和写作模式（改写/仿写/查数据库/联网搜索）
   - **文档上传**: 直接上传现有文档进行智能分析和优化
3. **上传相关文件**: 按需上传相关文件（原文、仿写文章、上级文件等）
4. **AI生成**: 点击"提交生成"，系统实时流式返回AI生成内容
5. **查看和导出**: 查看美观的Markdown渲染结果，支持多种导出方式：
   - 一键下载为docx文件
   - 制作PPT演示文稿（基于文档内容自动生成）
   - 直接从上传文档生成PPT（智能提取关键信息）

#### 技术特点
- **双API架构**: 集成两个Dify工作流API，分别用于报告生成和PPT生成
- **流式响应**: 支持实时流式返回，用户体验流畅
- **智能文档分析**: 自动识别上传文档的结构和内容，提供针对性优化建议
- **Markdown渲染**: 结果区支持美观的Markdown格式显示
- **SVG PPT预览**: PPT以SVG形式分页面展示，支持多页切换和高清预览
- **多模式PPT生成**: 支持从生成内容和上传文档两种方式制作PPT
- **智能内容提取**: 自动从文档中提取关键信息、标题、要点等制作演示文稿

### 业务查询系统功能

**业务查询系统** (Case2PG) 是基于Flask的企业级智能文件处理和数据库查询系统，集成了Dify AI工作流：

#### 主要功能
- **智能文件处理**: 支持多种文件格式上传和处理
- **AI工作流集成**: 集成Dify AI平台，实现智能文件分析和分类
- **数据库查询**: 基于AI分类结果自动查询相应数据库表
- **实时流式响应**: 支持SSE（Server-Sent Events）实时数据流
- **多环境配置**: 支持开发、测试、生产环境配置
- **连接池管理**: PostgreSQL数据库连接池优化

#### 使用流程
1. **访问系统主页**: 进入文件上传界面
2. **选择要上传的文件**: 支持多种文件格式
3. **AI自动处理**: 系统自动调用Dify工作流进行处理
4. **实时查看进度**: 实时查看处理进度和结果
5. **自动数据库查询**: 系统根据AI分类结果自动查询对应的数据库表

#### 技术特点
- **模块化架构**: 采用Flask蓝图和服务层架构设计
- **日志监控系统**: 完整的日志记录和性能监控
- **错误处理机制**: 统一的异常处理和错误响应
- **健康检查**: 系统健康状态监控，支持/health、/metrics等监控端点

### 数据处理系统功能

**数据处理系统** 提供专业的数据管理和处理解决方案，确保数据的安全性和可追溯性：

#### 主要功能
- **数据自动归档**: 支持数据自动归档和智能分类
- **多格式数据支持**: 兼容多种数据格式和文件类型
- **版本控制**: 完整的版本控制和历史追踪功能
- **存储优化**: 数据压缩和存储空间优化
- **权限管理**: 细粒度的权限管理和访问控制

#### 使用流程
1. **配置归档策略**: 配置归档策略和分类规则
2. **触发归档任务**: 自动或手动触发归档任务
3. **数据分类管理**: 系统进行数据分类和标签管理
4. **存储优化处理**: 执行存储优化和压缩处理
5. **查询和恢复**: 提供归档数据查询和恢复功能

#### 技术特点
- **分布式存储**: 采用分布式存储架构，确保数据安全
- **完整性校验**: 数据完整性校验和错误检测
- **增量备份**: 支持增量备份机制，节省存储空间
- **RESTful API**: 提供标准的RESTful API接口

### 文件审查系统功能

**文件审查系统** 是基于Flask和Dify AI的全栈Web应用，专为文件和合同智能审查而设计：

#### 主要功能
- **智能审查**: 集成Dify AI工作流，支持文件和合同的智能分析
- **多格式支持**: 支持多种文档格式上传和处理
- **角色定制**: 合同审查支持甲方/乙方/丙方身份选择
- **结果展示**: 初审/复审结果分离展示，支持Markdown渲染
- **文件下载**: 支持审查结果导出为Word文档
- **撤销功能**: 支持操作撤销，提升用户体验

#### 使用流程
1. **访问系统主页**: 进入审查系统界面
2. **选择审查类型**: 选择审查类型（文件审查/合同审查）
3. **上传待审查文件**: 支持拖拽上传多种文档格式
4. **选择审查身份**: 合同审查时可选甲方/乙方身份
5. **AI深度分析**: AI进行深度文档分析，实时显示审查进度
6. **查看和导出**: 查看初审和复审结果，支持Word文档导出

#### 技术特点
- **响应式设计**: 现代化UI，完美适配PC和移动端
- **实时反馈**: 审查进度实时显示，用户体验流畅
- **模块化架构**: 采用Flask模块化设计，代码结构清晰
- **安全机制**: API Token安全存储，文件上传类型验证

### 会议纪要生成系统功能

**会议纪要生成系统** 是统一门户的核心功能之一，提供智能化的会议记录处理和纪要生成服务：

#### 主要功能
- **音频上传**: 支持多种音频格式文件上传
- **智能转录**: 基于AI技术的语音转文字功能
- **音频拼接**: 支持多个音频文件的智能拼接处理
- **会议纪要生成**: 自动分析会议内容，生成结构化纪要
- **多人数识别**: 智能识别会议参与人数
- **主题提取**: 自动提取会议主要议题和关键内容

#### 使用流程
1. **上传音频**: 在音频上传区域选择或拖拽音频文件
2. **音频处理**: 系统自动进行音频优化和预处理
3. **音频拼接** (可选): 如需合并多个音频文件，使用音频拼接功能
4. **生成纪要**: 点击"生成会议纪要"按钮，系统将自动：
   - 转录音频内容
   - 分析会议结构
   - 提取关键信息
   - 生成格式化纪要
5. **结果导出**: 支持多种格式的纪要导出

#### 技术特点
- **高精度转录**: 采用先进的语音识别技术
- **智能分析**: AI驱动的内容理解和结构化处理
- **实时处理**: 支持大文件的流式处理
- **多格式支持**: 兼容常见音频格式

### 基本操作

1. **访问子系统**: 点击首页的系统卡片
2. **标签页管理**: 
   - 点击标签页切换系统
   - 右键标签页显示上下文菜单
   - 中键点击关闭标签页
3. **系统状态**: 点击右上角状态按钮查看健康状态

### 键盘快捷键

- `Ctrl + W`: 关闭当前标签页
- `Ctrl + R`: 刷新当前标签页
- `Ctrl + Tab`: 切换到下一个标签页

### API接口

- `GET /health`: 获取所有系统健康状态
- `GET /health/<service>`: 获取指定系统状态
- `GET /api/systems`: 获取系统配置信息
- `GET /writing/health`: 智能文件撰写系统健康检查
- `GET /qa_sys/health`: 业务查询系统健康检查
- `GET /case2pg/api/monitoring/health`: 数据处理系统健康检查
- `GET /censor/health`: 文件审查系统健康检查
- `GET /meeting_minutes/health`: 会议纪要生成系统健康检查

## 🛠️ 开发指南

### 添加新的子系统

1. **创建蓝图文件** (blueprints/new_system.py):
   ```python
   from flask import Blueprint, render_template, jsonify
   
   new_system_bp = Blueprint('new_system', __name__, url_prefix='/new_system')
   
   @new_system_bp.route('/')
   def index():
       return render_template('new_system.html')
   
   @new_system_bp.route('/health')
   def health():
       return jsonify({'status': 'healthy', 'service': 'new_system'})
   ```

2. **注册蓝图** (app.py):
   ```python
   from blueprints.new_system import new_system_bp
   app.register_blueprint(new_system_bp)
   ```

3. **更新配置** (config/settings.py):
   ```python
   SYSTEMS['new_system'] = {
       'name': '新系统',
       'description': '系统描述',
       'url': 'http://localhost:9000/new_system',
       'path': '/new_system',
       'icon': 'fas fa-cog',
       'color': '#10b981'
   }
   ```

### 健康检查机制

每个子系统都实现了专门的健康检查路由：
- 返回JSON格式的健康状态
- 支持详细的组件状态检查
- 统一的状态码：`healthy`、`degraded`、`unhealthy`

### 自定义样式

修改 `static/css/main.css` 和 `static/css/tabs.css` 来自定义界面样式。

### 日志配置

日志文件位置: `logs/app.log`

可以通过修改 `utils/logger.py` 来调整日志级别和格式。

## 🐛 故障排除

### 常见问题

1. **蓝图注册失败**
   - 检查蓝图文件是否正确导入
   - 确认蓝图名称没有冲突

2. **健康检查失败**
   - 检查各子系统的健康检查路由是否正常
   - 查看日志文件获取详细错误信息

3. **静态资源加载失败**
   - 确认静态文件路径正确
   - 检查文件权限设置

### 日志查看

```bash
# 查看应用日志
tail -f logs/app.log

# 查看错误日志
tail -f logs/error.log
```

## 📝 更新日志

### v2.1.0 (2024-12-XX)
- 新增会议纪要生成系统
- 支持音频文件上传和智能转录
- 实现音频拼接和处理功能
- 集成AI驱动的会议纪要自动生成
- 优化用户界面和交互体验

### v2.0.0 (2024-10-XX)
- 完成所有四个子系统的蓝图整合
- 统一使用9000端口管理所有服务
- 实现详细的健康检查机制
- 优化服务管理和监控功能

### v1.0.0 (2024-01-XX)
- 初始版本发布
- 支持四个子系统集成
- 实现标签页管理功能
- 添加健康监控和反向代理

## 🤝 贡献指南

1. Fork 项目
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 创建 Pull Request

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 📞 支持

如果您遇到问题或有建议，请：

1. 查看本文档的故障排除部分
2. 检查日志文件获取详细信息
3. 提交 Issue 描述问题

---

**享受使用统一门户系统！** 🎉